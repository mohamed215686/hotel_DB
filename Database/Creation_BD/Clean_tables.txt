-- ########################################################
-- SCRIPT: EMPTY ALL TABLES & RESET SEQUENCES
-- ########################################################

PROMPT Cleaning database...;

-- 1. DELETE DATA (Child tables first, then Parents)
DELETE FROM ASSOCIE;
DELETE FROM LIGNE_FACTURE;
DELETE FROM SYSTEM_AUDIT;
DELETE FROM RESERVATION;
DELETE FROM FACTURE;
DELETE FROM SERVICE;
DELETE FROM CHAMBRE;
DELETE FROM CLIENT;
DELETE FROM UTILISATEUR;
DELETE FROM ROLE;

-- Save the changes
COMMIT;

-- 2. RESET SEQUENCES (Drop and Re-create to start at 1)
BEGIN
  EXECUTE IMMEDIATE 'DROP SEQUENCE ROLE_SEQ';
  EXECUTE IMMEDIATE 'DROP SEQUENCE UTILISATEUR_SEQ';
  EXECUTE IMMEDIATE 'DROP SEQUENCE CLIENT_SEQ';
  EXECUTE IMMEDIATE 'DROP SEQUENCE CHAMBRE_SEQ';
  EXECUTE IMMEDIATE 'DROP SEQUENCE SERVICE_SEQ';
  EXECUTE IMMEDIATE 'DROP SEQUENCE RESERVATION_SEQ';
  EXECUTE IMMEDIATE 'DROP SEQUENCE FACTURE_SEQ';
  EXECUTE IMMEDIATE 'DROP SEQUENCE LIGNE_FACTURE_SEQ';
  EXECUTE IMMEDIATE 'DROP SEQUENCE SYSTEM_AUDIT_SEQ';
EXCEPTION
  WHEN OTHERS THEN NULL; -- Ignore if they don't exist
END;
/

-- Re-create starting at 1
CREATE SEQUENCE ROLE_SEQ START WITH 1 INCREMENT BY 1;
CREATE SEQUENCE UTILISATEUR_SEQ START WITH 1 INCREMENT BY 1;
CREATE SEQUENCE CLIENT_SEQ START WITH 1 INCREMENT BY 1;
CREATE SEQUENCE CHAMBRE_SEQ START WITH 1 INCREMENT BY 1;
CREATE SEQUENCE SERVICE_SEQ START WITH 1 INCREMENT BY 1;
CREATE SEQUENCE RESERVATION_SEQ START WITH 1 INCREMENT BY 1;
CREATE SEQUENCE FACTURE_SEQ START WITH 1 INCREMENT BY 1;
CREATE SEQUENCE LIGNE_FACTURE_SEQ START WITH 1 INCREMENT BY 1;
CREATE SEQUENCE SYSTEM_AUDIT_SEQ START WITH 1 INCREMENT BY 1;

PROMPT All tables are empty and sequences reset.;